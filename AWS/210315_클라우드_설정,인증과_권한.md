# 지난 주에 했던 내용

![image](https://user-images.githubusercontent.com/77096463/111091327-e84d9b00-8575-11eb-80f7-fbadcdfb7bb8.png)

![image](https://user-images.githubusercontent.com/77096463/111091786-6b232580-8577-11eb-89c0-aeb959103b09.png)

<br>

---------------

# 클라우드 설정

### 1. 보안 모델 및 자격 증명 관리

### IAM 사용자 생성 및 관리

**IAM 사용자**<br>

- 사용자, 애플리케이션, 서비스를 식별하는 AWS의 객체
  - 서비스 계정 : 애플리케이션 또는 서비스를 대신해 작업하도록 만든 IAM 사용자 / 액세스 키를 사용해서 AWS서비스 API에 접근 가능함

![image](https://user-images.githubusercontent.com/77096463/111093357-0cac7600-857c-11eb-956c-976fdadd2bb2.png)

<br>

- 사용자를 확인하는데 도움을 주는 친숙한 이름과 AWS에서 사용자를 고유하게 식별하는 ARN(Amazon Resource Name)가짐

- 일반적으로 사용자는 AWS에서 자원 및 서비스에 접근하는 데 사용할 수 있는 인증서 및 권한 집합을 가짐

**lambda-upload 사용자로 콘솔 로그인이 가능하도록 설정**<br>

  - IAM 사용자 > 보안 자격 증명 > 콘솔 비밀번호 활성화

![image](https://user-images.githubusercontent.com/77096463/111093068-46c94800-857b-11eb-844e-b6b276afd84d.png)

<br>

-  콘솔 로그인 링크를 통해 lambda-upload 사용자로 로그인 가능

![image](https://user-images.githubusercontent.com/77096463/111093224-bb9c8200-857b-11eb-8750-a953f219e1ab.png)

<br>

- 다중 요소 인증 설정 (MFA)

<br>

### 그룹 생성

**그룹**<br>

- IAM 사용자 모음
- 여러 사용자에 대해 사용 권한을 *한 번에* 지정할 수 있는 방법을 권장
- AWS에서는 사용자별로 권한을 정의하는 대신 그룹을 사용해 IAM 사용자에게 권한을 할당할 것을 권장
- 그룹에 속한 모든 사용자는 그룹에 할당된 권한을 상속받게 됨

<br>

lambda-upload 사용자에게 할당된 권한을 Lambda-DevOps 그룹을 이용해서 제공<br>
Lambda-Devops 그룹 생성

![image](https://user-images.githubusercontent.com/77096463/111093686-e63b0a80-857c-11eb-9064-b358f09d989c.png)

<br>

Lambda-Devops 그룹에 권한 설정

- 관리형 정책 : 일괄 적용 / 인라인 정책 : 해당 유저 혹은 그룹에 한해서만 권한을 부여하고 사용할 때 
- 인라인 정책 생성 > Lambda-Upload-Policy이름으로 아래 내용 입력

![image](https://user-images.githubusercontent.com/77096463/111094361-7ded2880-857e-11eb-90ad-84dd4ddf4c2e.png)

<br>

lambda-upload 사용자에 부여된 권한 삭제한 뒤, Lambda-Devops 그룹에 lambda-upload 사용자 추가

![image](https://user-images.githubusercontent.com/77096463/111094466-b5f46b80-857e-11eb-90b3-2134409b25e2.png)

<br>

![image](https://user-images.githubusercontent.com/77096463/111094641-0ec40400-857f-11eb-871b-da05696dc347.png)

<br>

### 역할 생성

**역할**<br>
- 일정 기간 동안 사용자, 애플리케이션, 서비스가 맡을 수 있는 권한 집합
- 특정 사용자에게 유일하게 결합되지 않고, 암호나 액세스 키와 같은 자격 증명도 없음
- 일반적으로 필요한 리소스에 접근할 수 없는 사용자 또는 서비스에 권한을 부여하도록 설계되어 있음 ex) 람다함수가 S3에 접근할 수 있도록 역할 생성

<br>

**위임**<br>
- 특정 자원에 대해 접근할 수 있도록 제 3자에게 권한을 부여
- 자원을 소유하고 있는 신뢰를 제공하는 계정 (trusting account)과 자원에 접근이 필요한 사용자 또는 애플리케이션을 포함한 신뢰를 제공받는 계정(trusted account) 간의 신뢰 관계(trust relationship)를 설정하는 작업

<br>

**연동(federation)**<br>

- 페이스북, 구글과 같은 외부 자격 증명 공급자 또는 SAML (Security Assertion Markup Language) 2.0 및 AWS를 지원하는 기업용 자격 증명 시스템 간에 신뢰 관계를 생성하는 프로세스
- 사용자는 외부 자격 증명 공급자를 통해 로그인하고 임시 자격 증명을 갖는 IAM 역할을 맡을 수 있음

<br>

### 권한

**자격 증명 기반 권한 (Identity-based Permission)**<br>
- IAM 사용자 또는 역할이 수행할 수 있는 것을 지정

**자원 기반 권한 (Resource-based Permission)**<br>

- S3 버킷, SNS 주제와 같은 AWS 자원에서 수행할 수 있는 것 또는 누가 그 자원에 접근할 수 있는지를 지정

- 주어진 자원에 접근할 수 있는 사용자 지정
- S3 버킷, SNS 주제, SQS 큐, Glacier 볼트, OpsWorks 스택, Lambda 함수 등의 서비스만 자원 기반 정책 제공

<br>

### 권한과 정책

- 사용자, 그룹, 역할이 수행할 수 있는 작업을 기술하는 정책을 생성해 권한 부여
- 정책 유형 -> 관리형 정책, 인라인 정책
  - 관리형 정책 (managed policies)
    - 사용자, 그룹, 역할에는 적용되지만 자원에는 적용되지 않음
    - 재사용, 변경관리, 버전관리, 롤백이 용이
  - 인라인 정책 (inline policies)
    - 특정 사용자, 그룹, 역할에 직접 생성하고 적용
    - 엔티티가 삭제되면 엔티티에 적용된 인라인 정책도 함께 삭제됨

```
{
  "Version": "2012-10-17",				<- 정책 언어 버전
  "Statement": [						<- 정책 구문 : 정책을 구성하는 실제 권한 지정
    {
      "Sid": "Stmt1451465505000",
      "Effect": "Allow",				<- 구문이 자원에 대한 접근 허용, 거부 여부 지정
      "Action": [						<- 자원에 허용되거나 거부되어야 하는 특정 작업 지정
        "lambda:GetFunction",			
        "lambda:UpdateFunctionCode",
        "lambda:UpdateFunctionConfiguration"
      ],
       "Condition": {					<- 해당 정책을 적용할 조건 명시 
           "DateLessThan": {          
               "aws:CurrentTime": "2016-10-12T12:00:00Z"
           }, 
           "IpAddress": {
               "aws:SourceIp": "127.0.0.1"
           }
       },
      "Resource": [						<- 구문이 적용되는 객체 식별
        "arn:aws:lambda:*"
      ]
    }
  ]
}
```

<br>

