# 커피 주문, 배달 MSA & Kafka

장고 : 규모적인 측면에서 큰 규모가 필요한 애플리케이션에 적합<br>
flask : 작은 규모의 웹 애플리케이션에 적합

<br>

### Flask 설치 및 예제 작성

### 0. Flask 설치

가상환경 생성 및 활성화

- `jinja` : fast, expressive, extensible templating engine

```
(base) C:\Users\Lenovo>conda create -n msa python=3.8 flask
(base) C:\Users\Lenovo>conda activate msa

(msa) C:\Users\Lenovo>pip list
Package      Version
------------ -------------------
certifi      2020.12.5
click        7.1.2
Flask        1.1.2
itsdangerous 1.1.0
Jinja2       2.11.3
MarkupSafe   1.1.1
pip          21.0.1
setuptools   52.0.0.post20210125
Werkzeug     1.0.1
wheel        0.36.2
wincertstore 0.2
```

<br>

### 1. Flask 기본 예제 작성 (app.py)

작업 디렉터리 생성 (C:\cloud\FLASK_DEMO)

app.py 작성 후 실행 확인

```python
from flask import Flask

# 서버를 띄우기 위한 객체 생성
app = Flask(__name__)

# http://127.0.0.1:5000/
@app.route('/')
def index():
    return "Hello, World!"

if __name__ == "__main__":
    app.run()
```

```
(msa) C:\cloud\FLASK_DEMO>flask run
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

<br>

간단한 코드로 웹 서버 접속 확인

![image](https://user-images.githubusercontent.com/77096463/113527999-44965e80-95fa-11eb-9dc3-3f3c07881304.png)

<br>

/health-check 엔드포인트 코드 추가 후 웹 서버 접속

```python
from flask import Flask

...

@app.route('/health-check')
def health_check():
    return "Server is running on 5000 port"

...
```

![image](https://user-images.githubusercontent.com/77096463/113528067-77405700-95fa-11eb-86e5-722cb7bc98fe.png)

<br>

/users 관련 엔드포인트 코드 추가 후 웹 서버 접속

```python
from flask import Flask

...

#사용자 전체 목록
@app.route('/users')
def users():
    return "** Users List"

# 가변 데이터 명시
# 사용자에 대한 상세 정보
@app.route('/users/<userId>')
def users_detail(userId):
    return "Welcome to Flask App, {}".format(userId)

...
```

![image](https://user-images.githubusercontent.com/77096463/113528324-3268f000-95fb-11eb-8cb3-0b420c0cf1d8.png)
![image](https://user-images.githubusercontent.com/77096463/113528344-3e54b200-95fb-11eb-9911-cc3e3f410401.png)

<br>

3000번 포트로 서버 기동

```
(msa) C:\cloud\FLASK_DEMO>flask run --port 3000
```

![image](https://user-images.githubusercontent.com/77096463/113528596-f8e4b480-95fb-11eb-8ce4-919ef29f4475.png)

<br>

jsonify 모듈을 import 하여 json 타입으로 결과값 출력하게 코드 수정

- `jsonify` : serializes data to [JavaScript Object Notation (JSON)](https://www.json.org/json-en.html) format, wraps it in a [Response](https://blog.miguelgrinberg.com/post/customizing-the-flask-response-class) object with the application/json mimetype

```python
from flask import Flask, jsonify

...

# 가변 데이터 명시
# 사용자에 대한 상세 정보
@app.route('/users/<userId>')
def users_detail(userId):
    #return "{\"name\":%s}" % (userId)
    return jsonify({"user_id" : userId})

...
```

`return jsonify({"user_id" : userId})` >  userId 값을 json 형태로 웹 서버에 출력 

![image](https://user-images.githubusercontent.com/77096463/113528940-0ea6a980-95fd-11eb-8713-b36dd406ad9e.png)

<br>

`return "{\"name\":%s}" % (userId)` > userId 값을 json 형태인 것처럼 출력하나 사실 이는 형태만 갖춘 문자열

![image](https://user-images.githubusercontent.com/77096463/113529094-81178980-95fd-11eb-9471-b061890b2169.png)

<br>

